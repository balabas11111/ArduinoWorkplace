/*
 * ButtonB.h
 *
 *  Created on: 13 ���. 2018 �.
 *      Author: Vitaliy
 */

#ifndef LIBRARIES_TIMETRIGGER_BUTTONB_H_
#define LIBRARIES_TIMETRIGGER_BUTTONB_H_

#define COMMAND_PREFFIX_BUTTON "PIN_SC"

#include "Arduino.h"
#include <FunctionalInterrupt.h>

class ButtonB{

public:
	ButtonB(uint8_t pin);
	ButtonB(String name,uint8_t pin,std::function<void(String)> funcEvent);
	ButtonB(String name,uint8_t pin,uint8_t _pinMode,std::function<void(String)> funcEvent,int _buttonMode,boolean _resetActionFlagAfterExecution,boolean _setActionOnlyIfChangedState);
	boolean checkPressed();
	boolean isStateChanged();
	boolean getPressed();
	boolean checkChangedToPressed();
	boolean isChangedToPressed();
	void setActionFlagOn(boolean actionFlagVal);
	void setActionFlagOff(boolean actionFlagVal);
	boolean getActionFlagOn(boolean doReset);
	boolean getActionFlagOff(boolean doReset);
	void defaultExecFunction();


	boolean loop();

private:
	String _name;
	uint8_t _pin;
	boolean _previousStatePressed;
	boolean _changedToPressed;
	boolean actionFlagOn;
	boolean actionFlagOff;
	boolean resetActionFlagAfterExecution;
	boolean setActionOnlyIfChangedState;
	std::function<void(String)> externalFunctionEvent;

	void init(String name,uint8_t pin,uint8_t _pinMode,std::function<void(String)> funcEvent,int _buttonMode,boolean _resetActionFlagAfterExecution,boolean _setActionOnlyIfChangedState);
	void setPressed(boolean pressed);
	void handleExternalFunction(uint8_t isTurnedOn);
	void handleInternalFunction();
	String constructCommand(uint8_t state);
};


#endif /* LIBRARIES_TIMETRIGGER_BUTTONB_H_ */

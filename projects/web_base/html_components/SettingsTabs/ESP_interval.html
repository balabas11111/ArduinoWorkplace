<html xmlns="http://www.w3.org/1999/xhtml" lang="ru-ru" xml:lang="ru">
<head>

 <script src="../../js/DeviceLib.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript">
	const jsonStr=`{"id":"123","name":"TimeIntervalService","type":"ScheduleService","size":"1",
		"descr":"TimeIntervalService_DESCR","itemCount":"2",
		"intervalType":["ONCE", "PERIODIC", "DAILY", "MULTIDAILY", "WEEKLY", "MONTHLY", "QUATERLY"],
		"intervalState":["NEW", "WAIT", "ACTIVE", "FINISHED", "TO_DELETE", "INACTIVE"],
		"dayOfWeekShort":["Mo","Tu","We","Th","Fr","Sa","Su"],
		"dayOfWeek":["Понедельник","Вторник","Среда","Четверг","Пятница","Суббота","Воскресенье"],
		"intervals":[
			{"id":"0","name":"item.name1","type":"DAILY","typeInt":"2",
				"state":"INACTIVE","stateInt":"5","disabled":"1",
				"startTime":"1546701591",
				"endTime":"1546787991",
				"days":"0,1,0,1,0,1,0",
				"param":"0",
					"startDateTime":{"unixTime":"1546701591",
										"year":"2019",
										"month":"1",
										"day":"5",
										"hour":"15",
										"minute":"19",
										"second":"51",
										"dayOfTheWeek":"6",
										"dayOfTheWeekNameShort":"Sa",
										"dayOfTheWeekName":"Суббота"
					},
					"endDateTime":{"unixTime":"1546787991",
									"year":"2019",
									"month":"1",
									"day":"6",
									"hour":"15",
									"minute":"19",
									"second":"51",
									"dayOfTheWeek":"7",
									"dayOfTheWeekNameShort":"Su",
									"dayOfTheWeekName":"Воскресенье"
								}
			},
			{"id":"1","name":"item.name2","type":"MULTIDAILY","typeInt":"3",
				"state":"WAIT","stateInt":"1","disabled":"0",
				"startTime":"1546528791",
				"endTime":"1546615191",
				"days":"1,1,1,0,0,0,0",
				"param":"0",
					"startDateTime":{"unixTime":"1546528791",
										"year":"2019",
										"month":"1",
										"day":"3",
										"hour":"15",
										"minute":"19",
										"second":"51",
										"dayOfTheWeek":"4",
										"dayOfTheWeekNameShort":"Th",
										"dayOfTheWeekName":"Четверг"
					},
					"endDateTime":{"unixTime":"1546528791",
									"year":"2019",
									"month":"1",
									"day":"4",
									"hour":"15",
									"minute":"19",
									"second":"51",
									"dayOfTheWeek":"5",
									"dayOfTheWeekNameShort":"Fr",
									"dayOfTheWeekName":"Пятница"
								}
			}
		]}`;

function getValueIndex(val,array){
	for (var i = 0; i < array.length; ++i){
		if(array[i]==val){
			return i;
		}
	}
	
	return -1;
}		
		
function activeToStringState(active,array){
	var val='WAIT';
	
	if(active=='0'){val='INACTIVE';}
	
	return getValueIndex(val,array);
}	

function multiDailyHandle(currentJson){
	
	var intervalType=document.getElementById('intervalType');
	
	const isMultidaily= intervalType.selectedIndex==getValueIndex('MULTIDAILY',currentJson.intervalType);
	
	if(isMultidaily){
		showComponent('dayOfWeek');
	}else{
		hideComponent('dayOfWeek');
	}
		
}
		
function intervalFormToJson(currentJson){
	var dayOfWeekComp=document.getElementById('dayOfWeek');
	var intervalActiveComp=document.getElementById('intervalActive');
	var array=currentJson.intervalState;
		
	var days=checkBoxListToArray(dayOfWeekComp).join(',');
	var active=getComponentValue(intervalActiveComp);
	
	var stateInt=activeToStringState(active,array);
		
	var result='{"id":"'+getComponentValueById('intervalId')+'","name":"'+getComponentValueById('intervalName')+'","type":"'+getComponentValueById('intervalType')+'","state":"'+stateInt+'","startTime":"'+getComponentValueById('startDateTime')+'","endTime":"'+getComponentValueById('endDateTime')+'","days":"'+days+'"}'
	return result;	
}

function onLoadPageComplete(){
	var currentJson=JSON.parse(jsonStr);
	var intervalInd=0;
	
	var dayOfWeekShort=document.getElementById('dayOfWeekShort');
	
	var intervalId=document.getElementById('intervalId');
	var intervalName=document.getElementById('intervalName');
	var intervalParam=document.getElementById('intervalParam');
	var intervalType=document.getElementById('intervalType');
	var intervalState=document.getElementById('intervalState');
	var intervalActive=document.getElementById('intervalActive');
	
	var startDateTime=document.getElementById('startDateTime');
	var endDateTime=document.getElementById('endDateTime');
	
	var dayOfWeek=document.getElementById('dayOfWeek');
	
	putItemsToComboCox(intervalType,currentJson.intervalType,currentJson.intervals[intervalInd].typeInt);
	putItemsToComboCox(intervalState,currentJson.intervalState,currentJson.intervals[intervalInd].stateInt);
	
	var startDateTimeVal=currentJson.intervals[intervalInd].startTime;
	var endDateTimeVal=currentJson.intervals[intervalInd].endTime;
	var dayOfWeekVal=currentJson.intervals[intervalInd].days.split(',');
	var dayOfWeekNames=currentJson.dayOfWeek;
	
	setComponentValue(intervalId,currentJson.intervals[intervalInd].id);
	setComponentValue(intervalName,currentJson.intervals[intervalInd].name);
	setComponentValue(intervalParam,currentJson.intervals[intervalInd].param);
	
	var active=currentJson.intervals[intervalInd].state!="INACTIVE"
	
	setComponentValue(intervalActive,active);
	
	setComponentValue(startDateTime,startDateTimeVal);
	setComponentValue(endDateTime,endDateTimeVal);
	
	arrayToCheckBoxList(dayOfWeek,'dayOfWeek',dayOfWeekVal,dayOfWeekNames);
	
	//alert(new Date(startTime.value));
	var resultText=intervalFormToJson(currentJson);
	setComponentValueById('resultText',resultText);
	
	multiDailyHandle(currentJson);
}



</script>

</head>
<body onload="onLoadPageComplete()">

<div id="CustomInterval_content">
<!-- start custom interval 
	<select id="dayOfWeekShort">
     </select>
     
     <select id="intervalType">
     </select>
     
     <select id="intervalState"></select>
     -->
     <div id="interval0">
     
     <div id="headerFrame">
     	<label for="intervalId">intervalId</label>
     	<input type="text" id="intervalId" name="intervalId"/>
     	
       	<label for="intervalName">intervalName</label>
     	<input type="text" id="intervalName" name="intervalName"/>
     	
     	<label for="intervalParam">intervalParam</label>
     	<input type="text" id="intervalParam" name="intervalParam"/>
     </div>
     
     <div id="typeFrame">
     	 <label for="intervalType">intervalType</label>
     	 <select id="intervalType"></select>
     	 
     	 <label for="intervalState">intervalState</label>
     	 <select id="intervalState"></select>
     	 
     	 <label for="intervalActive">intervalActive</label>
	     <input type="checkbox" id="intervalActive" name="intervalActive"/>
     </div>
     
     <div id="timeframe">
	     <label for="startDateTime">startDateTime</label>
	     <input type="datetime-local" id="startDateTime" name="startDateTime"/>
	     
	     <label for="endDateTime">endDateTime</label>
	     <input type="datetime-local" id="endDateTime" name="endDateTime"/>
	 </div>
	     
	     <div id="dayOfWeek">
	     	
	     </div>
     </div>
     
     <p>
     	<h1>result text</h1>
     	<div id="resultText"></div>
     </p>
     

<!-- end custom interval -->
</div>


</body>
</html>
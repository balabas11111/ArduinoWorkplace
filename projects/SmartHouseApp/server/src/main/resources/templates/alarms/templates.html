<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">

<body>

	<th:block th:fragment="AlarmsLink(itemType, itemTypeName, text)">
		<li th:class="${itemType.equalsIgnoreCase(itemTypeName)} ? active : ''">
      		<a th:href="@{~/alarmsList?itemType={itemTypeName}(itemTypeName=${itemTypeName})}" th:text=${text}>
      		Устройство</a>
      	</li>
	</th:block>

	<th:block th:fragment="AlarmsTable(alarms, itemTypeName)">
		<div  class="tab-pane fade in active">
		   <p>
			<a th:href="@{~/editAlarm?id=0&itemType={itemTypeName}(itemTypeName=${itemTypeName})}" class="btn btn-success">Новый</a>
			
			<table th:replace="alarms/templates :: AlarmsList(alarms=${alarms.get(itemTypeName)},itemTypeName=itemTypeName)"></table>
		   </p>
		</div>
	</th:block>

	<table class="table table-dark table-striped"
		th:fragment="AlarmsList(alarms,itemTypeName)">
		<th:block th:replace="alarms/templates :: AlarmHeader"></th:block>
		<tbody>
			<tr th:each="alarmIn : ${alarms}">
				<th:block th:replace="alarms/templates :: AlarmRow(alarm=${alarmIn}, itemType=${itemTypeName})">
			</tr>
		</tbody>
	</table>
	
	<table class="table table-dark table-striped"
		th:fragment="AlarmsMap(alarms,itemType)">
		<th:block th:replace="alarms/templates :: AlarmHeader"></th:block>
		<tbody>
			<th:block th:each="alarmName : ${alarms.get(itemType).keySet()}">
			<tr th:each="alarmIn : ${alarms.get(itemType).get(alarmName)}">
				<th:block th:replace="alarms/templates :: AlarmRow(alarm=${alarmIn}, itemType=${itemType})">
			</tr>
			</th:block>
		</tbody>
	</table>
	
	<th:block th:fragment="AlarmHeader">
		<thead>
			<tr>
				<th></th>
				<th>Описание</th>
				<th>Объект</th>
				<th>Состояние</th>
				<th></th>
				<th></th>
			</tr>
		</thead>
	</th:block>
	
	<th:block th:fragment="AlarmRow(alarm, itemType)">
		<td>
			<a
				th:href="@{~/editAlarm?id={id}&itemType={itemType}(id=${alarm.id},itemType=${alarm.itemType})}"
				th:text="${alarm.getDescription()}"
				class="btn btn-default">
			</a>
		</td>
		<td th:text="${alarm.getViewDescriptor().getHint()}"></td>
			<td>
				<button th:href="@{~/editAlarm?id={id}&itemType={itemType}(id=${alarm.id},itemType=${alarm.itemType})}" 
				th:replace="templates :: AlarmStateButton(text=${alarm.getItem().getEmojiDescriptionByDescriptionField()},title=${alarm.getStateDescriptionsWithNextLine()})"></button>
			</td>
			<td th:text="${alarm.getAlarmState().getEmojiDescription()}"></td>
			<td>
				<div th:if="${alarm.hasStateDescriptions()}">
					<div th:each="alarmDescription : ${alarm.getStateDescriptions()}">
						<label th:text="${alarmDescription}"></label>
					</div>
				</div>
			</td>
			<td>
				<button type="button" class="btn btn-default"
								data-toggle="modal"
								th:attr="data-target='#deleteAlarmModal' + ${alarm.id}+${alarm.itemType}">&#x274C;Удалить</button>

				<div class="modal fade" th:id="'deleteAlarmModal' + ${alarm.id}+${alarm.itemType}">
					<div class="modal-dialog">
						<div class="modal-content">

							<!-- Modal Header -->
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal">&times;</button>
								<h4 class="modal-title"
									th:text="'Действительно удалить ?    ' + ${alarm.description}">
									Действительно удалить ?</h4>
							</div>

							<!-- Modal footer -->
							<div class="modal-footer">
								<a th:href="@{~/deleteAlarm_{id}_{itemType}(id=${alarm.id}, itemType=${alarm.itemType})}"
									class="btn btn-success">Удалить</a>
								<button type="button" class="btn btn-danger"
									data-dismiss="modal">Отменить</button>
							</div>
						</div>
					</div>
				</div>

			</td>
	</th:block>

</body>

</html>
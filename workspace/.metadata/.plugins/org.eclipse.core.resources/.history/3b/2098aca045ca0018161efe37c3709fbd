/*
 * ButtonB.cpp
 *
 *  Created on: 13 џэт. 2018 у.
 *      Author: Vitaliy
 */

#include "Arduino.h"
#include "AbstractEvent.h"

//PIN_SC:01:001:onOffEvent:Button1   PIN_SC:pinID:pinstate:someStrCommand:dispatcher

AbstractEvent::AbstractEvent(String eventPreffix,uint8_t pin,uint8_t intCOmmand,String strCommand,String dispatcher){
	_eventPreffix=eventPreffix;
	_pin=pin;
	_intCOmmand=intCOmmand;
	_strCommand=strCommand;
	_dispatcher=dispatcher;

	_eventText=_eventPreffix+":"+_pin+":"+_intCOmmand+":"+_strCommand+":"+_dispatcher;

	Serial.println("Event parsed "+print());
}

AbstractEvent::AbstractEvent(String eventText){

	Serial.println("Construct event "+eventText);

	int ind[4];

	ind[0]=eventText.indexOf(":");
	ind[1]=eventText.indexOf(":",ind[0]);
	ind[2]=eventText.indexOf(":",ind[1]);
	ind[3]=eventText.indexOf(":",ind[2]);

	for(int i=0;i<sizeof(ind);i++){
		Serial.print(" ind["+String(i)+"]="+String(ind[i]));
	}

	Serial.println();

	_eventText=eventText;
	_eventPreffix=eventText.substring(0,ind[0]);
	_pin=eventText.substring(ind[0]-1,ind[1]).toInt();
	_intCOmmand=eventText.substring(ind[1]-1,ind[2]).toInt();
	_strCommand=eventText.substring(ind[2]-1,ind[3]);
	_dispatcher=eventText.substring(ind[3]-1);

	Serial.println("Event parsed "+print());
}

boolean AbstractEvent::isEventOfKind(String kind){
	return getPreffix().equals(kind);
}

String AbstractEvent::getPreffix(){
	return _eventPreffix;
}
uint8_t AbstractEvent::getPin(){
	return _pin;
}
uint8_t AbstractEvent::getIntCommand(){
	return _intCOmmand;
}
String AbstractEvent::getStrCommand(){
	return _strCommand;
}
String AbstractEvent::getDispatcher(){
	return _dispatcher;
}

void AbstractEvent::setDispatcher(String dispatcher){
	_dispatcher=dispatcher;
}

String AbstractEvent::getEventText(){
	return _eventText;
}

String AbstractEvent::print(){
return "_eventPreffix="+_eventPreffix+"_pin="+_pin+"_intCOmmand="+_intCOmmand+" _strCommand"+_strCommand+" _dispatcher="+_dispatcher;
}




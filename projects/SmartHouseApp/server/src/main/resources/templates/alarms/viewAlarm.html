<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
<th:block th:replace="templates :: headImportsUp" ></th:block>
</head>

<body>

<header th:replace="templates :: MainPageHeader(url=${baseUrl + '/virtual/devices'}, text=${'Тревога'})"></header>

	<div class="container">
		<h4 th:text="${pageHeader}"></h4>

			<input type="hidden" th:field="*{id}">
			<table class="table table-dark table-striped">
				<tr>
					<td th:text="${alarm.targetItemClass.getSimpleName()}"></td>
					<td th:text="${alarm.getPreviousAlarmState().getEmoji().toString() + ' -> ' + alarm.getAlarmState().getEmoji().toString()}">itemClass</td>
				</tr>
				<tr>
					<td>Описание</td>
					<td th:text="*{description}"></td>
				</tr>
				<tr>
					<td>Параметр</td>
					<td th:text="*{parameter}"></td>
				</tr>
				<tr>
					<td>Интервал</td>
					<td th:text="*{messageInterval}"></td>
				</tr>
				<tr>
					<td>Выпонить после завершения всех опасностей</td>
					<td><input disabled type="checkbox" th:field="*{postponed}" text="Выпонить после завершения всех опасностей"></td>
				</tr>
				<tr>
					<td>Процессор</td>
					<td>
						<div th:replace="templates :: IItemAbstractSelectParentChecker(items=${checkers}, chbxName='checkerName', selectedName=${currentCheckerName})"></div>
					</td>
				</tr>
				
				<tr>
					<td>
						<div class="accordion" id="accordionExample">
							  <div class="card">
							    <div class="card-header" id="headingOne">
							      <h2 class="mb-0">
							      	<button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
							          Описание цели
							        </button>
							      </h2>
							    </div>
							
							    <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
							      <div class="card-body">
							        <th:block th:replace="templates :: IItemAbstractLabelAlarmTarget(items=${targets}, selectedId=${alarm.getItemId()})"></th:block>
							      </div>
							    </div>
							  </div>
					</td>
				</tr>
			</table>

			<div th:if="${!alarm.isNew()}">
				
				<h4>События</h4>			
									
				<table class="table table-dark table-striped">
					<thead>
						<tr>
						    <th></th>
							<th>Описание</th>
							<th>Состояние 1</th>
							<th>Состояние 2</th>
							<th>Строка</th>
							<th>Параметры строки</th>
							<th>Процессор событий</th>
							<th>Показатель цель</th>
							<th></th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="actionItem : ${alarm.getActionsList()}">
						    <td th:text="${actionItem.getEmoji()}"></td>
							<td th:text="${actionItem.description}"></td>
							<td th:text="${actionItem.getOldState()}"></td>
							<td th:text="${actionItem.getNewState()}"></td>
							<td th:text="${actionItem.stringFormatted}"></td>
							<td th:text="${actionItem.stringParametersFormatted}"></td>
							<td th:text="${actionItem.targetBeanName}"></td>
							<td th:text="${actionItem.targetFieldId}"></td>
							<td th:text="${actionItem.disabledIfSameState}"></td>
							
							<td>
								<a th:href="@{~/deleteAction?id={id}&alarmId={alarmId}&itemType={itemType}(id=${actionItem.id}, alarmId=${alarm.id}, itemType=${itemType})}"
									class="btn btn-default">Удалить</a>
							</td>
						</tr>
					</tbody>
				</table>
			</div>

	</div>

	<footer th:replace="templates :: footer"></footer>
	<div th:replace="templates :: importsUp" th:remove="tag"></div>
</body>

</html>